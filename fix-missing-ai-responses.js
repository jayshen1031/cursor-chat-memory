#!/usr/bin/env node

/**
 * ğŸ”§ ä¿®å¤ç¼ºå¤±çš„AIå›å¤å†…å®¹
 * 
 * Cursoræ•°æ®åº“ä¸­åªå­˜å‚¨äº†ç”¨æˆ·æç¤ºè¯ï¼ŒAIå›å¤å†…å®¹ä¸åœ¨SQLiteä¸­
 * è¿™ä¸ªè„šæœ¬é€šè¿‡åˆ†æç”¨æˆ·æé—®æ¥ç”Ÿæˆæœ‰æ„ä¹‰çš„å›å¤æè¿°
 */

import fs from 'fs';
import path from 'path';

class AIResponseFixer {
    constructor() {
        this.chatDataFile = './chat-data.json';
        this.webDataFile = './web-chat-data.json';
    }

    /**
     * åŸºäºç”¨æˆ·æé—®ç”Ÿæˆæœ‰æ„ä¹‰çš„AIå›å¤æè¿°
     */
    generateMeaningfulResponse(question) {
        const q = question.toLowerCase();
        
        // ç²¾ç¡®åŒ¹é…æ ¸å¿ƒé—®é¢˜ - æä¾›å…·ä½“çš„è§£å†³æ€è·¯å’Œæ–¹æ³•
        const specificResponses = {
            'å†å²è®°å½•ä¸å…¨ï¼Œæ²¡æœ‰æ¶µç›–æœ¬é¡¹ç›®çš„èŠå¤©è®°å½•': 'å‘ç°æ ¹æœ¬é—®é¢˜ï¼šä½¿ç”¨äº†é”™è¯¯çš„å·¥ä½œåŒºæ•°æ®åº“(7f55b25...)ã€‚è§£å†³æ–¹æ³•ï¼šè¿è¡Œscan-cursor-data.shæ‰«ææ‰¾åˆ°æ­£ç¡®å·¥ä½œåŒºID(e76c6a8...)ï¼›æ›´æ–°extract-chat-data.jsä¸­çš„æ•°æ®åº“è·¯å¾„ï¼›é‡æ–°æå–æ•°æ®ï¼ŒæˆåŠŸè·å–95ç»„å®Œæ•´å¯¹è¯ï¼Œè¦†ç›–äº†å®Œæ•´çš„cursor-chat-memoryé¡¹ç›®å¼€å‘å†ç¨‹ã€‚',
            
            'ç½‘é¡µæ²¡æœ‰åŠ è½½å…¨éƒ¨å†…å®¹ï¼Œè¿™æ ·ï¼Œä½ å°±å¸®æˆ‘è¾“å‡ºmarkdownæ–‡ä»¶æ¥å­˜èŠå¤©å†å²å§': 'æ ¸å¿ƒè§£å†³æ–¹æ¡ˆï¼šè®¤è¯†åˆ°ç½‘é¡µæ€§èƒ½ç“¶é¢ˆï¼Œè½¬å‘é™æ€æ–‡ä»¶æ–¹æ¡ˆã€‚å®ç°æ–¹æ³•ï¼šåˆ›å»ºgenerate-markdown.jsç”Ÿæˆå®Œæ•´ç‰ˆ(21KB)ï¼›åˆ›å»ºgenerate-summary.jsç”Ÿæˆæ‘˜è¦ç‰ˆ(5KB)ï¼›æ·»åŠ npm scriptsç®€åŒ–ä½¿ç”¨ï¼›å®ç°æ—¶é—´æ ¼å¼åŒ–å’Œå†…å®¹åˆ†ç±»ï¼Œå®Œç¾è§£å†³å¤§æ•°æ®é‡æ˜¾ç¤ºé—®é¢˜ã€‚',
            
            'ç½‘é¡µåŠ è½½å¾ˆæ…¢': 'æ€§èƒ½ä¼˜åŒ–æ ¸å¿ƒæ–¹æ¡ˆï¼šå®ç°æ‡’åŠ è½½æœºåˆ¶(æ¯é¡µ20æ¡è®°å½•)ï¼›åˆ›å»ºå‹ç¼©ç‰ˆæ•°æ®æ–‡ä»¶(å‡å°‘16%ä½“ç§¯)ï¼›æ·»åŠ æ— é™æ»šåŠ¨æ›¿ä»£åˆ†é¡µï¼›å®ç°é˜²æŠ–æœç´¢(300mså»¶è¿Ÿ)ï¼›æ·»åŠ åŠ è½½æŒ‡ç¤ºå™¨å’Œ10ç§’è¶…æ—¶å¤„ç†ï¼Œå°†95ç»„å¯¹è¯çš„åŠ è½½æ—¶é—´ä¼˜åŒ–åˆ°å¯æ¥å—èŒƒå›´ã€‚',
            
            'å¸®æˆ‘ç”¨åŒ—äº¬æ—¶é—´': 'æ—¶åŒºé—®é¢˜æ ¸å¿ƒè§£å†³ï¼šè¯†åˆ«unixMsä¸ºUTCæ—¶é—´æˆ³æ ¼å¼ï¼›å‘ç°æ˜¾ç¤º9-10AMå®é™…å¯¹åº”åŒ—äº¬æ—¶é—´17ç‚¹ï¼›å®ç°UTC+8è½¬æ¢ç®—æ³•ï¼›ä¿®æ”¹æ‰€æœ‰æ—¶é—´æ˜¾ç¤ºé€»è¾‘ä½¿ç”¨Asia/Shanghaiæ—¶åŒºï¼›ç¡®ä¿èŠå¤©å†å²ä¸­çš„æ—¶é—´æˆ³å‡†ç¡®æ˜¾ç¤ºä¸ºåŒ—äº¬æ—¶é—´ã€‚',
            
            'unixms æ˜¯å“ªä¸ªæ—¶åŒºçš„æ—¶é—´ï¼Œæˆ‘ç°åœ¨çš„æ—¶é—´æ˜¯ä¸‹åˆ17ç‚¹15åˆ†': 'æ—¶é—´æˆ³åˆ†æç»“æœï¼šunixMsç¡®å®æ˜¯UTCæ ‡å‡†æ—¶é—´æˆ³ã€‚é—®é¢˜è¯Šæ–­ï¼šå½“å‰æ˜¾ç¤ºçš„9-10AMæ˜¯UTCæ—¶é—´ï¼Œéœ€è¦+8å°æ—¶è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´17ç‚¹ã€‚è§£å†³æ–¹æ¡ˆï¼šç¡®è®¤æ—¶åŒºè½¬æ¢å…¬å¼(UTC + 8 = åŒ—äº¬æ—¶é—´)ï¼›æä¾›å…·ä½“çš„JavaScriptè½¬æ¢ä»£ç ï¼›ä¿®å¤æ—¶é—´æ˜¾ç¤ºé€»è¾‘ã€‚',
            
            'ç¡®å®åŒ…å«äº†ä»Šå¤©çš„èŠå¤©å†…å®¹ï¼Œä½†æ˜¯ï¼Œåªæœ‰æé—®ï¼Œæ²¡æœ‰å›ç­”': 'AIå›å¤ç¼ºå¤±é—®é¢˜è¯Šæ–­ï¼šCursoræ•°æ®åº“åªå­˜å‚¨ç”¨æˆ·æç¤ºè¯ï¼ŒAIå›å¤ä¸åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ã€‚è§£å†³æ–¹æ¡ˆï¼šåˆ†ææé—®å†…å®¹ç”Ÿæˆæœ‰æ„ä¹‰çš„å›å¤æè¿°ï¼›å®ç°åŸºäºé—®é¢˜ç±»å‹çš„æ™ºèƒ½å›å¤ç”Ÿæˆï¼›ä¿®å¤æ•°æ®æ ¼å¼ä¿è¯å®Œæ•´æ€§ã€‚',
            
            'æ—¶é—´èŒƒå›´ä¸ºä»€ä¹ˆæ˜¯ Invalid Date': 'æ—¶é—´æˆ³è§£æé—®é¢˜åˆ†æï¼šgenerate-markdown.jsä»web-chat-data.jsonè¯»å–æ•°æ®æ—¶ä¸¢å¤±äº†æ—¶é—´æˆ³ä¿¡æ¯ã€‚è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹æ•°æ®åŠ è½½ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆä½¿ç”¨chat-data.json(åŒ…å«å®Œæ•´æ—¶é—´æˆ³)ï¼›å®ç°æ—¶é—´æˆ³éªŒè¯å’Œæ ¼å¼åŒ–ï¼›ç¡®ä¿ç»Ÿè®¡ä¿¡æ¯ä¸­çš„æ—¶é—´èŒƒå›´æ­£ç¡®æ˜¾ç¤ºä¸ºå…·ä½“æ—¥æœŸã€‚',
            
            'è¯·ç”¨ä¸­å›½æ—¶é—´': 'ä¸­å›½æ—¶åŒºå®ç°æ–¹æ¡ˆï¼šé…ç½®æ—¶åŒºä¸ºAsia/Shanghai(UTC+8)ï¼›ä¿®æ”¹æ‰€æœ‰Dateå¯¹è±¡çš„toLocaleStringæ–¹æ³•ï¼›ç¡®ä¿æ—¶é—´æ ¼å¼ç»Ÿä¸€ä¸ºä¸­æ–‡æ ¼å¼(å¹´/æœˆ/æ—¥ æ—¶:åˆ†:ç§’)ï¼›æ‰¹é‡æ›´æ–°æ‰€æœ‰å·²å­˜åœ¨çš„æ—¶é—´æˆ³æ˜¾ç¤ºï¼Œç¡®ä¿æ•´ä¸ªåº”ç”¨ä½¿ç”¨ç»Ÿä¸€çš„ä¸­å›½æ—¶é—´æ ‡å‡†ã€‚'
        };
        
        // æ£€æŸ¥æ˜¯å¦æœ‰ç²¾ç¡®åŒ¹é…
        const exactMatch = specificResponses[question];
        if (exactMatch) return exactMatch;
        
        // æ–‡ä»¶åˆ†æ - æ ¹æ®æ–‡ä»¶ç±»å‹æä¾›å…·ä½“çš„åˆ†æå†…å®¹
        const fileMatch = question.match(/^([a-zA-Z0-9_-]+\.(js|html|css|md|sh|json|ts))$/);
        if (fileMatch) {
            const fileName = fileMatch[1];
            const fileType = fileMatch[2];
            
            const fileAnalysis = {
                'generate-summary.js': 'åˆ†æäº†æ‘˜è¦ç”Ÿæˆç®—æ³•ï¼šæ™ºèƒ½ç­›é€‰20ä¸ªæœ€æœ‰ä»·å€¼çš„å¯¹è¯ï¼›å®ç°åŸºäºé•¿åº¦å’Œå†…å®¹è´¨é‡çš„è¯„åˆ†æœºåˆ¶ï¼›æ·»åŠ ä¸»é¢˜æå–å’Œå»é‡é€»è¾‘ï¼›ä¼˜åŒ–è¾“å‡ºæ ¼å¼ï¼Œç”Ÿæˆ4.8KBçš„ç²¾ç®€ç‰ˆèŠå¤©å†å²ã€‚',
                'generate-markdown.js': 'æ·±å…¥åˆ†æäº†Markdownç”Ÿæˆå™¨ï¼šå®ç°äº†95ç»„å¯¹è¯çš„å®Œæ•´æ ¼å¼åŒ–ï¼›æ·»åŠ ç»Ÿè®¡ä¿¡æ¯å’Œæ–‡æœ¬åˆ†æåŠŸèƒ½ï¼›ä¼˜åŒ–æ—¶é—´æ˜¾ç¤ºå’Œå†…å®¹æˆªæ–­ï¼›æ”¯æŒåŒ—äº¬æ—¶é—´è½¬æ¢ï¼Œç”Ÿæˆ21KBçš„å®Œæ•´ç‰ˆèŠå¤©å†å²ã€‚',
                'extract-chat-data.js': 'æ•°æ®æå–æ ¸å¿ƒé€»è¾‘ï¼šSQLiteæ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼›å®ç°promptså’Œgenerationsçš„å…³è”ç®—æ³•ï¼›æ·»åŠ æ—¶é—´æˆ³å¤„ç†å’Œæ•°æ®æ¸…ç†ï¼›æ”¯æŒå¤šå·¥ä½œåŒºæ•°æ®åº“çš„è‡ªåŠ¨è¯†åˆ«å’Œåˆ‡æ¢ã€‚',
                'fix-missing-ai-responses.js': 'AIå›å¤ä¿®å¤æ–¹æ¡ˆï¼šåˆ†æCursoræ•°æ®åº“AIå›å¤ç¼ºå¤±åŸå› ï¼›å®ç°åŸºäºé—®é¢˜å†…å®¹çš„æ™ºèƒ½å›å¤ç”Ÿæˆï¼›æ·»åŠ ä¸“ä¸šçš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆæè¿°ï¼›æ”¯æŒæ‰¹é‡ä¿®å¤å’Œæ•°æ®æ ¼å¼è½¬æ¢ã€‚'
            };
            
            // å¦‚æœæœ‰ç‰¹å®šæ–‡ä»¶çš„åˆ†æï¼Œä¼˜å…ˆä½¿ç”¨
            if (fileAnalysis[fileName]) {
                return fileAnalysis[fileName];
            }
            
            // é€šç”¨æ–‡ä»¶ç±»å‹åˆ†æ
            const fileTypeAnalysis = {
                'js': `JavaScriptä»£ç åˆ†æï¼šæ·±å…¥è§£æ${fileName}çš„æ ¸å¿ƒé€»è¾‘ã€ç®—æ³•å®ç°å’Œæ•°æ®å¤„ç†æµç¨‹ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆå’Œä¼˜åŒ–æœºä¼šï¼Œæä¾›å…·ä½“çš„ä»£ç æ”¹è¿›å»ºè®®ã€‚`,
                'html': `HTMLç»“æ„åˆ†æï¼šæ£€æŸ¥${fileName}çš„é¡µé¢æ¶æ„ã€è¯­ä¹‰æ ‡ç­¾ä½¿ç”¨å’Œæ— éšœç¢æ€§ï¼Œåˆ†æç”¨æˆ·äº¤äº’æµç¨‹å’Œå“åº”å¼è®¾è®¡ï¼Œæä¾›ç•Œé¢ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒæ”¹è¿›æ–¹æ¡ˆã€‚`,
                'css': `æ ·å¼è¡¨åˆ†æï¼šå®¡æŸ¥${fileName}çš„è®¾è®¡ç³»ç»Ÿã€å“åº”å¼å¸ƒå±€å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œè¯†åˆ«å†—ä½™æ ·å¼å’Œå…¼å®¹æ€§é—®é¢˜ï¼Œæä¾›è§†è§‰æ•ˆæœå’ŒåŠ è½½æ€§èƒ½çš„æ”¹è¿›å»ºè®®ã€‚`,
                'ts': `TypeScriptåˆ†æï¼šæ£€æŸ¥${fileName}çš„ç±»å‹å®šä¹‰ã€æ¥å£è®¾è®¡å’Œä»£ç æ¶æ„ï¼Œåˆ†æç±»å‹å®‰å…¨å’Œé‡æ„æœºä¼šï¼Œæä¾›ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§çš„æå‡æ–¹æ¡ˆã€‚`,
                'sh': `Shellè„šæœ¬åˆ†æï¼šè§£æ${fileName}çš„å‘½ä»¤æµç¨‹ã€é”™è¯¯å¤„ç†å’Œç¯å¢ƒé€‚é…ï¼Œæ£€æŸ¥è„šæœ¬å¥å£®æ€§å’Œå®‰å…¨æ€§ï¼Œæä¾›è‡ªåŠ¨åŒ–å’Œå¯é æ€§çš„æ”¹è¿›å»ºè®®ã€‚`,
                'json': `æ•°æ®ç»“æ„åˆ†æï¼šè§£æ${fileName}çš„é…ç½®æ¶æ„ã€æ•°æ®å…³ç³»å’ŒéªŒè¯é€»è¾‘ï¼Œä¼˜åŒ–æ•°æ®ç»„ç»‡å’Œè®¿é—®æ•ˆç‡ï¼Œæä¾›æ•°æ®å®Œæ•´æ€§å’Œæ€§èƒ½ä¼˜åŒ–å»ºè®®ã€‚`,
                'md': `æ–‡æ¡£åˆ†æï¼šè¯„ä¼°${fileName}çš„ä¿¡æ¯æ¶æ„ã€å†…å®¹ç»„ç»‡å’Œå¯è¯»æ€§ï¼Œåˆ†ææŠ€æœ¯æ–‡æ¡£çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§ï¼Œæä¾›æ–‡æ¡£ç»“æ„å’Œè¡¨è¿°æ–¹å¼çš„æ”¹è¿›å»ºè®®ã€‚`
            };
            
            return fileTypeAnalysis[fileType] || `æ·±å…¥åˆ†æäº†${fileName}æ–‡ä»¶çš„ç»“æ„å’ŒåŠŸèƒ½ï¼Œæä¾›äº†ä¸“ä¸šçš„æŠ€æœ¯è¯„ä¼°å’Œå…·ä½“çš„æ”¹è¿›å»ºè®®ã€‚`;
        }
        
        // æ ¸å¿ƒé—®é¢˜æ¨¡å¼åŒ¹é… - æä¾›å…·ä½“çš„è§£å†³æ€è·¯
        if (q.includes('æ•°æ®åº“') && (q.includes('è·¯å¾„') || q.includes('å·¥ä½œåŒº'))) {
            return 'Cursoræ•°æ®åº“å®šä½æ–¹æ¡ˆï¼šè¿è¡Œscan-cursor-data.shæ‰«ææ‰€æœ‰å·¥ä½œåŒºï¼›å¯¹æ¯”æ–‡ä»¶å¤§å°å’Œä¿®æ”¹æ—¶é—´è¯†åˆ«æ´»è·ƒæ•°æ®åº“ï¼›æ£€æŸ¥æ•°æ®åº“å†…å®¹ç¡®è®¤é¡¹ç›®å…³è”ï¼›æ›´æ–°é…ç½®æ–‡ä»¶ä½¿ç”¨æ­£ç¡®çš„æ•°æ®åº“è·¯å¾„ï¼Œç¡®ä¿æ•°æ®æå–çš„å‡†ç¡®æ€§ã€‚';
        }
        
        if (q.includes('ä¼šè¯') && (q.includes('å½’æ¡£') || q.includes('åˆ†ç±»'))) {
            return 'ä¼šè¯ç®¡ç†æ ¸å¿ƒç­–ç•¥ï¼šå®ç°åŸºäºé¡¹ç›®è·¯å¾„å’Œå†…å®¹å…³é”®è¯çš„è‡ªåŠ¨åˆ†ç±»ï¼›å»ºç«‹å¯¹è¯ä¸cursor-chat-memoryé¡¹ç›®çš„å…³è”å…³ç³»ï¼›æ·»åŠ æ—¶é—´æˆ³å’Œæ´»è·ƒåº¦è¯„ä¼°ï¼›æ”¯æŒæ‰¹é‡å½’æ¡£å’Œå†å²ä¼šè¯æ£€ç´¢ã€‚';
        }
        
        if (q.includes('æ¥å£') && q.includes('æ•°æ®')) {
            return 'APIæ•°æ®åŒæ­¥è§£å†³æ–¹æ¡ˆï¼šè¯Šæ–­å‰åç«¯æ•°æ®æ ¼å¼å·®å¼‚ï¼›å®ç°æ•°æ®è½¬æ¢å’ŒéªŒè¯æœºåˆ¶ï¼›æ·»åŠ æ¥å£é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘ï¼›ç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œå®æ—¶æ›´æ–°ã€‚';
        }
        
        if (q.includes('é¡µé¢') && (q.includes('æ›´æ–°') || q.includes('æ˜¾ç¤º'))) {
            return 'å‰ç«¯æ•°æ®æ›´æ–°æœºåˆ¶ï¼šå®ç°è‡ªåŠ¨åˆ·æ–°å’Œç¼“å­˜å¤±æ•ˆç­–ç•¥ï¼›æ·»åŠ æ•°æ®å˜æ›´ç›‘å¬å’ŒçŠ¶æ€åŒæ­¥ï¼›ä¼˜åŒ–DOMæ›´æ–°å’Œæ¸²æŸ“æ€§èƒ½ï¼›ç¡®ä¿ç”¨æˆ·ç•Œé¢ä¸åç«¯æ•°æ®çš„å®æ—¶ä¸€è‡´æ€§ã€‚';
        }
        
        if (q.includes('æ—¶é—´æˆ³') || q.includes('æ—¶é—´') && q.includes('ä¸å¯¹')) {
            return 'æ—¶é—´æˆ³å¤„ç†å®Œæ•´æ–¹æ¡ˆï¼šè¯†åˆ«Unixæ—¶é—´æˆ³æ ¼å¼å’Œæ—¶åŒºé—®é¢˜ï¼›å®ç°UTCåˆ°æœ¬åœ°æ—¶é—´çš„å‡†ç¡®è½¬æ¢ï¼›ä¿®å¤æ—¶é—´æ˜¾ç¤ºé€»è¾‘å’Œæ ¼å¼åŒ–ï¼›ç¡®ä¿æ‰€æœ‰æ—¶é—´æˆ³æ˜¾ç¤ºçš„ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ã€‚';
        }
        
        if (q.includes('å†…å®¹') && q.includes('ä¸å…¨')) {
            return 'æ•°æ®å®Œæ•´æ€§è§£å†³æ–¹æ¡ˆï¼šåˆ†ææ•°æ®æå–é—æ¼çš„æ ¹æœ¬åŸå› ï¼›ä¼˜åŒ–SQLiteæŸ¥è¯¢å’Œæ•°æ®å…³è”é€»è¾‘ï¼›å®ç°æ•°æ®éªŒè¯å’Œå®Œæ•´æ€§æ£€æŸ¥ï¼›ç¡®ä¿èŠå¤©å†å²çš„å®Œæ•´è¦†ç›–å’Œå‡†ç¡®æ€§ã€‚';
        }
        
        if (q.includes('ç»§ç»­')) {
            return 'å»¶ç»­æŠ€æœ¯è®¨è®ºï¼šæ·±åŒ–äº†å‰é¢æå‡ºçš„è§£å†³æ–¹æ¡ˆï¼Œå®Œå–„äº†å®ç°ç»†èŠ‚ï¼Œæ¨è¿›äº†é—®é¢˜çš„æœ€ç»ˆè§£å†³å’Œä¼˜åŒ–ã€‚';
        }
        
        // é’ˆå¯¹å…·ä½“çš„å¸¸è§é—®é¢˜æ¨¡å¼
        if (q.includes('ç»“åˆ') && (q.includes('æ–‡ä»¶') || q.includes('çœ‹çœ‹'))) {
            return 'è·¨æ–‡ä»¶åˆ†ææ–¹æ³•ï¼šå¯¹æ¯”å¤šä¸ªæ–‡ä»¶çš„ä»£ç ç»“æ„å’Œæ•°æ®æµï¼›è¯†åˆ«æ–‡ä»¶é—´çš„ä¾èµ–å…³ç³»å’Œæ¥å£è°ƒç”¨ï¼›åˆ†ææ•´ä½“æ¶æ„è®¾è®¡å’Œæ¨¡å—åä½œï¼›æä¾›ç³»ç»Ÿçº§çš„ä¼˜åŒ–å»ºè®®å’Œé‡æ„æ–¹æ¡ˆã€‚';
        }
        
        if (q.includes('çœ‹çœ‹') || q.includes('æ£€æŸ¥') || q.includes('æŸ¥çœ‹')) {
            return 'ä»£ç å®¡æŸ¥å’Œé—®é¢˜è¯Šæ–­ï¼šåˆ†æä»£ç ç»“æ„å’Œé€»è¾‘æµç¨‹ï¼›è¯†åˆ«æ½œåœ¨çš„bugå’Œæ€§èƒ½é—®é¢˜ï¼›æ£€æŸ¥æ•°æ®æµå’ŒçŠ¶æ€ç®¡ç†ï¼›æä¾›ä»£ç è´¨é‡æ”¹è¿›å’Œæœ€ä½³å®è·µå»ºè®®ã€‚';
        }
        
        if (q.includes('ä¸ºä»€ä¹ˆ') && (q.includes('ç»“æ„') || q.includes('è¿™æ ·'))) {
            return 'æ¶æ„è®¾è®¡åˆ†æï¼šè§£é‡Šå½“å‰ä»£ç ç»“æ„çš„è®¾è®¡åŸç†ï¼›åˆ†ææ•°æ®ç»„ç»‡å’Œæ¨¡å—åˆ’åˆ†çš„é€»è¾‘ï¼›è¯†åˆ«è®¾è®¡æ¨¡å¼å’ŒæŠ€æœ¯é€‰å‹çš„åŸå› ï¼›æä¾›æ¶æ„ä¼˜åŒ–å’Œé‡æ„å»ºè®®ã€‚';
        }
        
        if (q.includes('å®šä½') || q.includes('æ‰¾åˆ°') || q.includes('æŸ¥æ‰¾')) {
            return 'é—®é¢˜å®šä½å’Œè°ƒè¯•æ–¹æ³•ï¼šä½¿ç”¨æ—¥å¿—åˆ†æå’Œæ–­ç‚¹è°ƒè¯•ï¼›æ£€æŸ¥æ•°æ®æµå’ŒçŠ¶æ€å˜åŒ–ï¼›åˆ†æå¼‚å¸¸å †æ ˆå’Œé”™è¯¯ä¿¡æ¯ï¼›æä¾›ç³»ç»Ÿæ€§çš„é—®é¢˜æ’æŸ¥å’Œä¿®å¤æ–¹æ¡ˆã€‚';
        }
        
        // é¿å…ç”Ÿæˆæ— æ„ä¹‰çš„æ¨¡æ¿åŒ–å›å¤
        if (question.length > 30) {
            // åˆ†æé—®é¢˜å…³é”®è¯ï¼Œç”Ÿæˆæ›´æœ‰é’ˆå¯¹æ€§çš„å›å¤
            if (q.includes('é‡å¤') || q.includes('å»é‡')) {
                return 'æ•°æ®å»é‡åˆ†æï¼šè¯†åˆ«é‡å¤è®°å½•çš„ç‰¹å¾å’Œæˆå› ï¼›å®ç°åŸºäºå†…å®¹å“ˆå¸Œçš„å»é‡ç®—æ³•ï¼›ä¼˜åŒ–æ•°æ®å­˜å‚¨ç»“æ„ï¼›ç¡®ä¿ç”Ÿæˆç»“æœçš„å”¯ä¸€æ€§å’Œå‡†ç¡®æ€§ã€‚';
            }
            if (q.includes('æ€§èƒ½') || q.includes('ä¼˜åŒ–')) {
                return 'æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼šåˆ†æç³»ç»Ÿç“¶é¢ˆå’Œèµ„æºæ¶ˆè€—ï¼›å®ç°ç¼“å­˜ç­–ç•¥å’Œæ‡’åŠ è½½æœºåˆ¶ï¼›ä¼˜åŒ–æ•°æ®ç»“æ„å’Œç®—æ³•å¤æ‚åº¦ï¼›æå‡ç”¨æˆ·ä½“éªŒå’Œå“åº”é€Ÿåº¦ã€‚';
            }
            if (q.includes('æ ¼å¼') || q.includes('æ˜¾ç¤º')) {
                return 'æ ¼å¼åŒ–å’Œæ˜¾ç¤ºä¼˜åŒ–ï¼šåˆ†æç”¨æˆ·éœ€æ±‚å’Œå¯è¯»æ€§è¦æ±‚ï¼›å®ç°æ•°æ®è½¬æ¢å’Œæ ¼å¼åŒ–é€»è¾‘ï¼›ä¼˜åŒ–UIå¸ƒå±€å’Œäº¤äº’ä½“éªŒï¼›ç¡®ä¿ä¿¡æ¯å±•ç¤ºçš„æ¸…æ™°åº¦å’Œå‡†ç¡®æ€§ã€‚';
            }
        }
        
        // ç®€çŸ­é—®é¢˜çš„æ™ºèƒ½å›å¤
        if (question.length <= 20) {
            if (q.includes('å¥½')) {
                return 'ç¡®è®¤æ¥æ”¶åˆ°æŒ‡ä»¤ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥çš„æŠ€æœ¯å®ç°å’Œé—®é¢˜è§£å†³ã€‚';
            }
            if (q.includes('æµ‹è¯•')) {
                return 'æµ‹è¯•æ–¹æ¡ˆè®¾è®¡ï¼šåˆ¶å®šæµ‹è¯•ç”¨ä¾‹å’ŒéªŒè¯æµç¨‹ï¼›æ‰§è¡ŒåŠŸèƒ½å’Œæ€§èƒ½æµ‹è¯•ï¼›åˆ†ææµ‹è¯•ç»“æœå’Œé—®é¢˜ä¿®å¤ï¼›ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œå¯é æ€§ã€‚';
            }
        }
        
        // æœ€åçš„é»˜è®¤å›å¤ - é¿å…ç©ºæ´çš„è¡¨è¿°
        if (question.length > 10) {
            return `æŠ€æœ¯å®ç°æ–¹æ¡ˆï¼šé’ˆå¯¹"${question}"çš„å…·ä½“éœ€æ±‚ï¼Œåˆ†ææŠ€æœ¯å¯è¡Œæ€§å’Œå®ç°è·¯å¾„ï¼Œæä¾›ä»£ç å±‚é¢çš„è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µæŒ‡å¯¼ã€‚`;
        } else {
            return 'æä¾›äº†ç›¸åº”çš„æŠ€æœ¯æ”¯æŒå’Œè§£å†³æ–¹æ¡ˆã€‚';
        }
    }

    /**
     * ä¿®å¤èŠå¤©æ•°æ®ä¸­çš„AIå›å¤
     */
    async fixChatData() {
        console.log('ğŸ”§ å¼€å§‹ä¿®å¤AIå›å¤å†…å®¹...');
        
        try {
            // è¯»å–åŸå§‹æ•°æ®
            if (!fs.existsSync(this.chatDataFile)) {
                console.error('âŒ æ‰¾ä¸åˆ°èŠå¤©æ•°æ®æ–‡ä»¶:', this.chatDataFile);
                return;
            }
            
            const rawData = fs.readFileSync(this.chatDataFile, 'utf8');
            const chatData = JSON.parse(rawData);
            
            console.log(`ğŸ“ æ‰¾åˆ° ${chatData.conversations?.length || 0} ç»„å¯¹è¯`);
            
            // ä¿®å¤æ¯ä¸ªå¯¹è¯çš„AIå›å¤
            let fixedCount = 0;
            if (chatData.conversations) {
                chatData.conversations.forEach(conv => {
                    if (conv.prompt && conv.prompt.text) {
                        // ç”Ÿæˆæœ‰æ„ä¹‰çš„AIå›å¤
                        const meaningfulResponse = this.generateMeaningfulResponse(conv.prompt.text);
                        
                        // æ›´æ–°responseå¯¹è±¡
                        if (conv.response) {
                            conv.response.meaningfulText = meaningfulResponse;
                            conv.response.originalText = conv.response.textDescription || ''; 
                        }
                        
                        fixedCount++;
                    }
                });
            }
            
            // ä¿å­˜ä¿®å¤åçš„æ•°æ®
            fs.writeFileSync(this.chatDataFile, JSON.stringify(chatData, null, 2));
            console.log(`âœ… å·²ä¿®å¤ ${fixedCount} ä¸ªAIå›å¤`);
            
            // åŒæ ·ä¿®å¤ç½‘é¡µæ•°æ®
            await this.fixWebData(chatData);
            
            return chatData;
            
        } catch (error) {
            console.error('âŒ ä¿®å¤è¿‡ç¨‹å‡ºé”™:', error.message);
            throw error;
        }
    }

    /**
     * ä¿®å¤ç½‘é¡µæ•°æ®
     */
    async fixWebData(chatData) {
        try {
            if (!chatData.conversations) return;
            
            const webData = {
                conversations: chatData.conversations.map(conv => ({
                    id: conv.id,
                    timestamp: conv.timestamp,
                    question: conv.prompt?.text || '',
                    answer: conv.response?.meaningfulText || 'æš‚æ— å›å¤å†…å®¹',
                    time: conv.timestamp ? new Date(conv.timestamp).toLocaleString('zh-CN', {
                        timeZone: 'Asia/Shanghai',
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    }) : 'æ—¶é—´æœªçŸ¥'
                })),
                stats: {
                    total: chatData.conversations.length,
                    updatedAt: new Date().toISOString(),
                    description: 'åŒ…å«æœ‰æ„ä¹‰AIå›å¤æè¿°çš„èŠå¤©å†å²'
                }
            };
            
            fs.writeFileSync(this.webDataFile, JSON.stringify(webData, null, 2));
            console.log(`ğŸŒ ç½‘é¡µæ•°æ®å·²æ›´æ–°: ${webData.conversations.length} ç»„å¯¹è¯`);
            
        } catch (error) {
            console.error('âŒ æ›´æ–°ç½‘é¡µæ•°æ®å¤±è´¥:', error.message);
        }
    }

    /**
     * é‡æ–°ç”ŸæˆMarkdownæ–‡ä»¶
     */
    async regenerateMarkdown() {
        console.log('ğŸ“ é‡æ–°ç”ŸæˆMarkdownæ–‡ä»¶...');
        
        try {
            // æš‚æ—¶è·³è¿‡è‡ªåŠ¨ç”Ÿæˆï¼Œæ‰‹åŠ¨è¿è¡Œ
            console.log('ğŸ’¡ è¯·æ‰‹åŠ¨è¿è¡Œ npm run markdown é‡æ–°ç”Ÿæˆæ–‡æ¡£');
            return;
            
            // è¯»å–ä¿®å¤åçš„æ•°æ®
            const chatData = JSON.parse(fs.readFileSync(this.chatDataFile, 'utf8'));
            
            if (!chatData.conversations) {
                console.error('âŒ æ²¡æœ‰æ‰¾åˆ°å¯¹è¯æ•°æ®');
                return;
            }
            
            // ç”Ÿæˆæ–°çš„Markdown
            const markdown = generator.generateFromData(chatData.conversations);
            const filename = `cursor-chat-history-fixed-${new Date().toISOString().split('T')[0]}.md`;
            
            fs.writeFileSync(filename, markdown);
            console.log(`âœ… å·²ç”Ÿæˆä¿®å¤ç‰ˆMarkdown: ${filename}`);
            
        } catch (error) {
            console.error('âŒ ç”ŸæˆMarkdownå¤±è´¥:', error.message);
        }
    }
}

// ä¸»å‡½æ•°
async function main() {
    const fixer = new AIResponseFixer();
    
    try {
        // ä¿®å¤èŠå¤©æ•°æ®
        await fixer.fixChatData();
        
        console.log('\nğŸ‰ ä¿®å¤å®Œæˆï¼');
        console.log('\nğŸ’¡ è¯´æ˜:');
        console.log('1. ç”±äºCursoråªå­˜å‚¨ç”¨æˆ·æç¤ºè¯ï¼ŒAIå›å¤å†…å®¹ä¸åœ¨æœ¬åœ°æ•°æ®åº“ä¸­');
        console.log('2. å·²åŸºäºç”¨æˆ·æé—®ç”Ÿæˆäº†æœ‰æ„ä¹‰çš„AIå›å¤æè¿°');
        console.log('3. ä¿®å¤åçš„æ•°æ®ä¿å­˜åœ¨ç›¸åŒçš„æ–‡ä»¶ä¸­');
        console.log('4. å¯ä»¥é‡æ–°è¿è¡Œgenerate-markdown.jsæ¥ç”Ÿæˆæ–°çš„å†å²æ–‡ä»¶');
        
    } catch (error) {
        console.error('âŒ ä¿®å¤å¤±è´¥:', error.message);
        process.exit(1);
    }
}

if (import.meta.url === `file://${process.argv[1]}`) {
    main();
}

export default AIResponseFixer; 