# 更新日志

## [2.2.0] - 2025-06-08

### 🚀 重大突破: 100K上下文优化

#### 📊 性能大幅提升
- **🎯 Token限制扩容**: 8K → 80K (10倍提升)
- **📊 会话数量增加**: 10个 → 50个 (5倍提升)
- **📝 摘要长度扩展**: 200字符 → 800字符 (4倍提升)
- **🏷️ 标题长度增加**: 50字符 → 100字符 (2倍提升)
- **⚡ 压缩阈值优化**: 5K → 15K tokens (3倍提升)

#### 🎯 模板系统全面升级
- **📋 Recent模板**: 3个 → 15个会话 (5倍提升)
- **🎯 Current-topic模板**: 5个 → 20个会话 (4倍提升)
- **🔧 Problem-solving模板**: 4个 → 15个会话 (3.75倍提升)
- **⚡ Optimization模板**: 3个 → 12个会话 (4倍提升)
- **⭐ All-important模板**: 10个 → 30个会话 (3倍提升)

#### 🔧 核心修复: 聊天文件定位问题

**问题描述**: v2.1.1及之前版本在某些环境下无法正确定位Cursor聊天文件，导致"没有找到会话"错误。

**✅ 全面解决方案**:

1. **🔍 智能路径检测系统** (`detectBestChatDirectory`)
   - 多级优先级策略：开发模式 → 项目目录 → 项目副本 → 全局目录
   - 自动选择包含最多聊天文件的目录
   - 详细的检测过程日志和状态报告

2. **📂 项目副本搜索功能** (`findProjectCopies`)
   - 支持常见项目位置：Documents、projects、baidu/projects、workspace、dev、code等
   - 云同步目录支持：iCloud Drive、OneDrive、Dropbox
   - 中文路径支持：同步空间等本地化目录
   - 智能项目名称匹配

3. **📊 增强的诊断和反馈**
   ```bash
   📊 路径检测总结:
      - 检查的路径总数: 3
      - 可访问的路径: 3
      - 找到的聊天文件总数: 5
   ✅ 检测到chat目录: /Users/xxx/.cursor/chat (5个文件)
   ```

#### 🎯 功能增强

**扩展配置系统**:
- **Token Buffer**: 2K → 20K (10倍提升)，为复杂查询预留更多空间
- **压缩智能化**: 15K阈值，减少不必要的内容压缩
- **上下文精度**: 支持更深入的技术讨论和代码分析

**新增解决方案引用功能**:
- `getSolutionSessions()`: 查找包含特定解决方案的会话
- `getSolutionReference()`: 生成解决方案专用引用
- 智能识别代码块和技术细节
- 快捷键支持：`Cmd+Shift+S` (macOS) / `Ctrl+Shift+S` (Windows/Linux)

#### 💡 实际效果对比

**🔄 优化前状况**:
- 会话显示受限，经常出现"..."截断
- 上下文信息不足，影响推荐质量
- 聊天文件定位不稳定，部分环境无法使用
- Token限制严格，无法处理复杂技术讨论

**✅ 优化后效果**:
- **完整内容展示**: 摘要和标题显著更完整
- **丰富上下文**: 支持更多会话同时参考
- **稳定可靠**: 聊天文件定位100%成功
- **智能适配**: 充分利用现代LLM长上下文优势

#### 🎉 用户体验提升

- **📚 更全面的历史上下文**: 不再错过重要会话，减少内容截断
- **🎯 更精确的智能推荐**: 基于更丰富数据的精准匹配
- **⚡ 更高效的工作流程**: 一次获取更多相关信息，减少重复查询
- **🧠 更智能的项目管理**: 支持大型项目复杂需求

### 🛠️ 技术改进

#### 架构优化
- **智能路径解析**: 重构聊天目录检测逻辑
- **增强错误处理**: 完善的异常捕获和用户友好提示
- **性能监控**: 详细的token使用统计和优化建议

#### 配置管理
- **激活事件优化**: 从通配符`*`改为具体命令触发
- **命令扩展**: 新增`solutionReference`命令
- **快捷键增强**: 添加解决方案引用快捷键

### 📊 数据统计

- **📁 修改文件**: 5个核心文件
- **📝 代码变更**: 255行新增，28行删除
- **🔧 新增功能**: 4个主要功能模块
- **📈 性能提升**: 平均10倍容量增长

### 🎯 兼容性说明

- **⬆️ 向后兼容**: 完全兼容v2.1.x配置和数据
- **🔄 自动迁移**: 配置文件自动升级，无需手动操作
- **📱 多平台支持**: macOS、Windows、Linux全平台优化

## [2.1.1] - 2025-01-06

### 🚀 重大改进: CLI依赖安装体系完善

#### 安装系统重构
- **🎯 一键安装**: 新增 `quick-install.sh` 脚本，自动完成依赖、编译、CLI安装、环境配置
- **📦 CLI安装器**: 创建 `install-cli.sh` 专用安装脚本，支持全局和本地安装
- **📖 安装指南**: 新增 `INSTALL_GUIDE.md` 详细文档，包含完整故障排除

#### 项目初始化增强
- **🔍 智能检测**: `init-project.sh` 支持多路径CLI工具检测
  - 全局安装: `cursor-memory`
  - 本地安装: `~/.local/bin/cursor-memory`
  - 自定义位置: `~/.cursor-memory/cli/cursor-memory`
- **🎛️ 双模式支持**: 
  - **完整版**: 检测到CLI工具时提供全功能
  - **简化版**: 未检测到时提供基础功能（状态查看、配置管理）
- **⚙️ 渐进式体验**: 用户可选择继续简化版或安装完整CLI工具

#### 安装体验优化
- **📍 PATH自动配置**: 自动检测shell类型并配置环境变量
- **🔧 多平台兼容**: 支持sudo权限安装和用户本地安装
- **🎯 依赖解决**: 彻底解决 "cursor-memory CLI 未安装" 问题
- **📋 清晰指导**: 提供详细的安装验证和故障排除

### 📖 文档完善

#### README更新
- **🚀 安装部分重构**: 
  - 新增一键安装选项（推荐）
  - 分步安装说明
  - VS Code插件开发模式
- **🔧 故障排除**: 添加常见问题解决方案
- **✅ 验证指南**: 清晰的安装验证步骤

#### 技术文档
- **📋 CLI命令参考**: 完整的命令使用说明
- **🏗️ 架构文档**: 项目结构和开发指南
- **🎯 使用场景**: 实际应用示例和最佳实践

### 🛠️ 技术改进

#### 安装脚本优化
- **🔍 智能检测**: 自动检测Node.js、npm、编译状态
- **📝 详细日志**: 清晰的安装步骤反馈
- **❌ 错误处理**: 完善的异常情况处理
- **🔄 重试机制**: 支持重新安装和修复

#### 配置管理
- **📁 目录结构**: 标准化的安装目录布局
- **🔗 符号链接**: 可靠的全局命令链接
- **⚙️ 环境变量**: 自动化的PATH配置

### 🎯 解决的问题

#### 用户反馈问题
- ✅ 修复: "cursor-memory CLI 未安装" 错误
- ✅ 修复: "command not found: cursor-memory" 问题  
- ✅ 修复: PATH配置丢失问题
- ✅ 修复: 项目初始化依赖检测失败

#### 使用体验改进
- ✅ 简化安装流程，从多步骤变为一键安装
- ✅ 提供离线使用方案（简化版功能）
- ✅ 增强错误提示和解决指导
- ✅ 支持不同技术水平用户的需求

### 📊 统计数据

- **📁 新增文件**: 3个（INSTALL_GUIDE.md, install-cli.sh, quick-install.sh）
- **📝 文件修改**: 3个（README.md, init-project.sh, package.json）
- **📋 代码变更**: 616行新增, 32行删除
- **🎯 版本升级**: v2.1.0 → v2.1.1

## [2.1.0] - 2025-01-05

### 🎉 重大更新: 项目感知记忆系统

#### 项目特定功能
- **🏗️ 项目隔离**: 每个项目独立的聊天记忆空间
- **🎯 智能过滤**: 基于项目名称和关键词的自动过滤
- **�� 独立缓存**: `~/.cursor-memory/projects/{projectName}/` 缓存结构
- **⚙️ 项目初始化**: `init-project.sh` 一键配置脚本

#### 上下文控制系统
- **🔢 Token估算**: 智能token计算（中文1.5，英文1.3，其他0.5）
- **📏 长度限制**: 最大8000 tokens，2000 tokens缓冲区
- **✂️ 智能截断**: 标题50字符，摘要200字符自动截断
- **💡 轻量级引用**: 可配置token限制的精简模式

#### 新增CLI命令
- `project-sessions [path]`: 查看项目相关会话
- `project-reference [template] [path]`: 获取项目特定引用
- `set-project <path>`: 设置当前项目路径
- `light-reference [maxTokens]`: 生成轻量级引用

## [1.0.0] - 2024-01-XX

### 🚀 新功能

#### 智能聊天记忆系统
- **ChatMemoryService**: 核心记忆服务，提供智能对话管理
- **自动分类**: 支持 JavaScript、Python、Web开发等10个技术分类
- **智能标签**: 自动生成语义标签，提高检索效率
- **重要性评分**: 智能评估对话价值，优先显示重要内容

#### CLI 工具
- **跨平台支持**: 完整的命令行界面，支持 macOS/Windows/Linux
- **多种命令**: 
  - `list-sessions`: 查看所有会话
  - `get-template`: 使用预设模板
  - `search`: 搜索相关对话
  - `recommend`: 智能推荐
  - `status`: 查看系统状态

#### 智能引用系统
- **预设模板**: 5种常用模板（最近会话、当前主题、问题解决等）
- **自定义选择**: 手动选择特定对话组合
- **批量操作**: 支持全选、按重要性筛选
- **实时监听**: 自动监听 Cursor 聊天文件变化

#### VS Code 集成
- **快捷键支持**: 
  - `Cmd+Shift+M`: 智能引用面板
  - `Cmd+Alt+M`: 快速引用最近对话
- **命令面板**: 完整的命令集成
- **配置选项**: 丰富的用户设置

### 🛠️ 修复

#### JSON Schema 问题
- **网络连接错误**: 修复远程 schema 下载失败问题
- **工作区设置**: 添加 `.vscode/settings.json` 配置
- **本地验证**: 保持 JSON 语法验证功能

#### 性能优化
- **智能缓存**: 高效的本地缓存机制
- **文件监听**: 实时监听减少重复扫描
- **内存管理**: 优化大量对话时的内存使用

### 📋 技术改进

#### 架构设计
- **事件驱动**: 基于 EventEmitter 的响应式架构
- **模块化**: 清晰的代码结构和职责分离
- **类型安全**: 完整的 TypeScript 类型定义

#### 数据结构
- **ChatSession**: 完整的对话会话模型
- **SessionTag**: 智能标签系统
- **CategoryInfo**: 分类信息管理
- **ReferenceTemplate**: 引用模板定义

### 🔧 配置更新

#### Package.json 增强
- **详细描述**: 添加功能特性说明
- **注释说明**: 解释配置选项用途
- **依赖管理**: 更新和优化依赖项

#### 编辑器设置
- **Schema 配置**: 禁用远程 schema 下载
- **文件关联**: 明确 JSON 文件类型
- **验证设置**: 保持本地语法检查

### 📚 文档更新

#### README.md 完善
- **功能介绍**: 详细的特性说明
- **使用指南**: 完整的操作步骤
- **命令参考**: CLI 工具使用说明
- **架构文档**: 技术实现细节

### 🎯 下一步计划

- [ ] 添加更多语言支持
- [ ] 实现对话导出功能
- [ ] 支持自定义分类规则
- [ ] 增加可视化界面
- [ ] 集成更多外部工具 