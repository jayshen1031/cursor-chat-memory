<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cursor Chat Memory 智能聊天记忆管理中心">
    <meta name="theme-color" content="#4299e1">
    
    <!-- 性能优化 - 预加载关键资源 -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="script.js" as="script">
    <link rel="dns-prefetch" href="//localhost">
    
    <!-- 关键CSS内联以减少渲染阻塞 -->
    <style>
        /* 关键路径CSS - 避免FOUC */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .app { min-height: 100vh; display: flex; flex-direction: column; }
        .loading { 
            position: fixed; 
            top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(255,255,255,0.9); 
            display: none; z-index: 9999; 
        }
        .loading.show { display: flex; align-items: center; justify-content: center; }
    </style>
    
    <title>🧠 Cursor Chat Memory - 管理中心</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- 头部导航 -->
        <header class="header">
            <div class="header-content">
                <h1>🧠 Cursor Chat Memory 管理中心</h1>
                <div class="header-actions">
                    <button id="refreshBtn" class="btn btn-secondary">🔄 刷新</button>
                    <div class="project-info">
                        <span id="projectPath">项目: cursor-chat-memory</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主导航标签 -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="sessions">📋 历史会话</button>
            <button class="tab-btn" data-tab="prompts">🧠 提示词中心</button>
            <button class="tab-btn" data-tab="reference">⚡ 引用生成</button>
            <button class="tab-btn" data-tab="analysis">🧠 智能分析</button>
            <button class="tab-btn" data-tab="analytics">📊 统计分析</button>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 历史会话管理 -->
            <div id="sessions-tab" class="tab-content active">
                <div class="tab-header">
                    <h2>📋 历史会话管理</h2>
                    <div class="toolbar">
                        <input type="text" id="sessionSearch" placeholder="搜索会话..." class="search-input">
                        <select id="categoryFilter" class="filter-select">
                            <option value="">所有分类</option>
                            <option value="JavaScript">JavaScript</option>
                            <option value="Python">Python</option>
                            <option value="数据库">数据库</option>
                            <option value="其他">其他</option>
                        </select>
                        <button id="searchSessionsBtn" class="btn btn-primary">🔍 搜索</button>
                    </div>
                </div>
                
                <div class="sessions-full-container">
                    <div id="sessionsContainer" class="sessions-container">
                        <!-- 会话列表将在这里动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 提示词中心管理 -->
            <div id="prompts-tab" class="tab-content">
                <div class="tab-header">
                    <h2>🧠 提示词中心</h2>
                    <div class="toolbar">
                        <input type="text" id="promptSearch" placeholder="搜索提示词..." class="search-input">
                        <select id="typeFilter" class="filter-select">
                            <option value="">所有类型</option>
                            <option value="global">全局知识</option>
                            <option value="project">项目经验</option>
                            <option value="iteration">迭代记录</option>
                        </select>
                        <button id="searchPromptsBtn" class="btn btn-primary">🔍 搜索</button>
                        <button id="createPromptBtn" class="btn btn-success">➕ 创建提示词</button>
                    </div>
                </div>
                
                <div class="prompts-full-container">
                    <div id="promptsContainer" class="prompts-container">
                        <!-- 提示词列表将在这里动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 引用生成 -->
            <div id="reference-tab" class="tab-content">
                <div class="tab-header">
                    <h2>⚡ 智能引用生成</h2>
                </div>
                
                <div class="reference-generator">
                    <div class="input-section">
                        <h3>输入您的问题或上下文</h3>
                        <textarea id="contextInput" placeholder="例如: 如何优化React性能、数据库查询问题..." rows="4"></textarea>
                        
                        <div class="reference-options">
                            <div class="option-group">
                                <h4>引用模板</h4>
                                <select id="templateSelect" class="template-select">
                                    <option value="recent">最近会话</option>
                                    <option value="current-topic">当前主题</option>
                                    <option value="problem-solving">问题解决</option>
                                    <option value="optimization">性能优化</option>
                                    <option value="all-important">重要精选</option>
                                </select>
                            </div>
                            
                            <div class="option-group">
                                <label>
                                    <input type="checkbox" id="includePrompts" checked>
                                    包含推荐提示词
                                </label>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button id="generateReferenceBtn" class="btn btn-primary">🚀 生成引用</button>
                            <button id="getRecommendationsBtn" class="btn btn-secondary">💡 获取推荐</button>
                        </div>
                    </div>
                    
                    <div class="output-section">
                        <h3>生成的引用内容</h3>
                        <div id="referenceOutput" class="reference-output">
                            <!-- 引用内容将在这里显示 -->
                        </div>
                        <div class="output-actions">
                            <button id="copyReferenceBtn" class="btn btn-success" style="display: none;">📋 复制到剪贴板</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 智能分析 -->
            <div id="analysis-tab" class="tab-content">
                <div class="tab-header">
                    <h2>🧠 智能分析中心</h2>
                    <div class="analyzer-selector">
                        <label class="radio-label">
                            <input type="radio" name="analyzer" value="local" checked>
                            <span>🧠 本地Claude分析器</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="analyzer" value="openai">
                            <span>🤖 Azure OpenAI</span>
                        </label>
                    </div>
                </div>

                <!-- 流程指导 -->
                <div class="workflow-guide">
                    <h3>🎯 建议的分析流程</h3>
                    <div class="workflow-steps">
                        <div class="workflow-step" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>首次使用：智能整合</h4>
                                <p>整合现有提示词，优化知识结构</p>
                            </div>
                        </div>
                        <div class="workflow-step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>定期执行：批量提炼</h4>
                                <p>分析新增会话，提取关键信息</p>
                            </div>
                        </div>
                        <div class="workflow-step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>项目总结：知识图谱</h4>
                                <p>生成项目全貌，获得深度洞察</p>
                            </div>
                        </div>
                    </div>
                    <div class="project-info">
                        <span id="currentProject">🏗️ 当前项目: cursor-chat-memory</span>
                        <span id="projectSessionCount">📊 项目会话: 加载中...</span>
                    </div>
                </div>
                
                <div class="analysis-dashboard">
                    <div class="analysis-grid">
                        <!-- 智能提炼 -->
                        <div class="analysis-card">
                            <h3>📝 智能提炼</h3>
                            <p>从历史会话中提取关键技术信息和解决方案</p>
                            <div class="analysis-actions">
                                <button id="batchSummarizeBtn" class="btn btn-primary">📚 批量提炼会话</button>
                                <button id="singleSummarizeBtn" class="btn btn-secondary">📄 单会话提炼</button>
                            </div>
                            <div id="summarizeResults" class="analysis-results">
                                <!-- 提炼结果 -->
                            </div>
                        </div>

                        <!-- 智能整合 -->
                        <div class="analysis-card">
                            <h3>🔧 智能整合</h3>
                            <p>整合现有提示词模板，去除冗余，优化结构</p>
                            <div class="analysis-actions">
                                <button id="smartIntegrateBtn" class="btn btn-primary">🚀 开始整合</button>
                                <button id="viewKnowledgeBaseBtn" class="btn btn-secondary">📚 查看知识库</button>
                            </div>
                            <div id="integrateResults" class="analysis-results">
                                <!-- 整合结果 -->
                            </div>
                        </div>

                        <!-- 项目知识图谱 -->
                        <div class="analysis-card full-width">
                            <h3>📊 项目知识图谱</h3>
                            <p>分析项目整体架构、技术栈、挑战和解决方案模式</p>
                            <div class="analysis-actions">
                                <button id="generateKnowledgeBtn" class="btn btn-primary">🎯 生成知识图谱</button>
                                <button id="viewProjectKnowledgeBtn" class="btn btn-secondary">📖 查看现有图谱</button>
                            </div>
                            <div id="knowledgeResults" class="analysis-results">
                                <!-- 知识图谱结果 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 统计分析 -->
            <div id="analytics-tab" class="tab-content">
                <div class="tab-header">
                    <h2>📊 统计分析</h2>
                </div>
                
                <div class="analytics-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>会话统计</h3>
                            <div id="sessionStats" class="stat-content">
                                <!-- 会话统计信息 -->
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>提示词统计</h3>
                            <div id="promptStats" class="stat-content">
                                <!-- 提示词统计信息 -->
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>分类分布</h3>
                            <div id="categoryStats" class="stat-content">
                                <!-- 分类统计信息 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 会话详情全屏模态框 -->
    <div id="sessionDetailModal" class="session-detail-modal">
        <div class="session-detail-container">
            <div class="session-detail-header">
                <h1 id="sessionDetailTitle">会话详情</h1>
                <button class="session-detail-close" onclick="SessionManager.closeFullscreenDetail()">×</button>
            </div>
            <div class="session-detail-main">
                <div class="session-detail-sidebar">
                    <div id="sessionMetaInfo" class="fullscreen-meta-tags">
                        <!-- 会话元信息 -->
                    </div>
                    <div id="sessionStatistics" class="fullscreen-content-summary">
                        <!-- 会话统计信息 -->
                    </div>
                </div>
                <div class="session-detail-content">
                    <div id="sessionMainContent" class="fullscreen-content-section">
                        <!-- 会话消息内容 -->
                    </div>
                </div>
            </div>
            <div class="fullscreen-actions">
                <button id="useSessionBtn" class="fullscreen-btn primary">📋 生成引用</button>
                <button id="copySessionBtn" class="fullscreen-btn secondary">📋 复制内容</button>
                <button id="editSessionBtn" class="fullscreen-btn secondary">✏️ 编辑会话</button>
                <button id="deleteSessionBtn" class="fullscreen-btn danger">🗑️ 删除会话</button>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">标题</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 模态框内容 -->
            </div>
            <div class="modal-footer">
                <button id="modalCancel" class="btn btn-secondary">取消</button>
                <button id="modalConfirm" class="btn btn-primary">确认</button>
            </div>
        </div>
    </div>

    <!-- 加载指示器 -->
    <div id="loading" class="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>加载中...</p>
        </div>
    </div>

    <!-- 通知容器 -->
    <div id="notifications" class="notifications">
        <!-- 通知消息将在这里显示 -->
    </div>

    <!-- 加载指示器 -->
    <div id="loading" class="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>加载中...</p>
        </div>
    </div>

    <!-- 通知容器 -->
    <div id="notifications" class="notifications"></div>

    <!-- 全屏提示词详情模态 -->
    <div id="promptDetailModal" class="prompt-detail-modal">
        <div class="prompt-detail-container">
            <div class="prompt-detail-header">
                <h1 id="promptDetailTitle">提示词详情</h1>
                <button class="prompt-detail-close" onclick="PromptManager.closeFullscreenDetail()">
                    ✕
                </button>
            </div>
            <div class="prompt-detail-main">
                <div class="prompt-detail-sidebar">
                    <div id="promptDetailSidebar">
                        <!-- 侧边栏内容 -->
                    </div>
                </div>
                <div class="prompt-detail-content">
                    <div id="promptDetailMainContent">
                        <!-- 主要内容 -->
                    </div>
                </div>
            </div>
            <div class="fullscreen-actions">
                <div id="promptDetailActions">
                    <!-- 操作按钮 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 异步加载非关键JS -->
    <script defer src="script.js"></script>
    
    <!-- 初始化脚本 -->
    <script>
        // 性能监控
        window.addEventListener('load', () => {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('页面加载时间：', perfData.loadEventEnd - perfData.fetchStart, 'ms');
            }
        });

        // 启用懒加载
        document.addEventListener('DOMContentLoaded', () => {
            if ('IntersectionObserver' in window) {
                PerformanceUtils?.lazyLoadImages();
            }
        });

        // 离线检测
        window.addEventListener('online', () => {
            console.log('网络连接已恢复');
        });
        
        window.addEventListener('offline', () => {
            console.log('网络连接已断开');
        });
    </script>
</body>
</html> 