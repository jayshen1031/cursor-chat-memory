<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cursor Chat Memory 智能聊天记忆管理中心">
    <meta name="theme-color" content="#4299e1">
    
    <!-- 性能优化 - 预加载关键资源 -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="script.js" as="script">
    <link rel="dns-prefetch" href="//localhost">
    
    <!-- 关键CSS内联以减少渲染阻塞 -->
    <style>
        /* 关键路径CSS - 避免FOUC */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .app { min-height: 100vh; display: flex; flex-direction: column; }
        .loading { 
            position: fixed; 
            top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(255,255,255,0.9); 
            display: none; z-index: 9999; 
        }
        .loading.show { display: flex; align-items: center; justify-content: center; }
    </style>
    
    <title>🧠 Cursor Chat Memory - 管理中心</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- 头部导航 -->
        <header class="header">
            <div class="header-content">
                <h1>🧠 Cursor Chat Memory 管理中心</h1>
                <div class="header-actions">
                    <button id="refreshBtn" class="btn btn-secondary">🔄 刷新</button>
                    <div class="project-info">
                        <span id="projectPath">项目: cursor-chat-memory</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主导航标签 -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="extraction" onclick="TabManager.switchTab('extraction')">🧠 项目知识</button>
            <button class="tab-btn" data-tab="analysis" onclick="TabManager.switchTab('analysis')">🧠 智能分析</button>
            <button class="tab-btn" data-tab="analytics" onclick="TabManager.switchTab('analytics')">📊 统计分析</button>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 📊 项目知识管理标签页 -->
            <div id="extraction-tab" class="tab-content active">
                <div class="data-extraction-container">
                     
  
                    <!-- 三栏知识管理布局 -->
                    <div class="knowledge-layout">
                        <!-- 左栏：历史会话 -->
                        <div class="sessions-panel">
                            <div class="panel-header">
                                <h3>📋 历史会话</h3>
                                <div class="panel-actions">
                                    <select class="form-select" id="projectFilter" onchange="KnowledgeManager.filterByProject(this.value)">
                                        <option value="all">全部项目</option>
                                        <option value="cursor-chat-memory">cursor-chat-memory</option>
                                        <option value="other">其他项目</option>
                                    </select>
                                    <input type="text" class="search-input" placeholder="搜索会话..." id="sessionSearch" 
                                           oninput="KnowledgeManager.searchSessions(this.value)">
                                </div>
                            </div>
                            <div class="sessions-list" id="sessionsList">
                                <!-- 会话列表将通过JavaScript填充 -->
                                <div class="empty-state">
                                    <p>🔍 正在加载历史会话...</p>
                                </div>
                            </div>
                        </div>

                        <!-- 中栏：内容详情与提炼 -->
                        <div class="content-panel">
                            <div class="panel-header">
                                <h3>📄 会话内容</h3>
                                <div class="panel-actions">
                                    <button class="btn btn-primary" onclick="KnowledgeManager.extractContent()" id="extractBtn">
                                        🔍 提炼核心内容
                                    </button>
                                </div>
                            </div>
                            <div class="content-detail" id="contentDetail">
                                <div class="empty-state">
                                    <p>👆 请从左侧选择一个会话查看详细内容</p>
                                </div>
                            </div>
                        </div>

                        <!-- 右栏：全局知识库 -->
                        <div class="knowledge-panel">
                            <div class="panel-header">
                                <h3>🧠 全局知识库</h3>
                                <div class="panel-actions">
                                    <select class="form-select" id="knowledgeFilter" onchange="KnowledgeManager.filterKnowledge(this.value)">
                                        <option value="all">全部分类</option>
                                        <option value="sop">操作规范</option>
                                        <option value="architecture">架构设计</option>
                                        <option value="implementation">实现方案</option>
                                        <option value="engineering">工程实践</option>
                                    </select>
                                    <button class="btn btn-secondary" onclick="KnowledgeManager.exportKnowledge()" title="导出知识库">
                                        📤
                                    </button>
                                </div>
                            </div>
                            <div class="knowledge-content" id="knowledgeContent">
                                <!-- 全局知识库内容 -->
                                <div class="empty-state">
                                    <p>🧠 正在整理项目知识...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 底部状态栏 -->
                    <div class="knowledge-status">
                        <div class="status-info">
                            <span id="sessionCount">会话: 0</span> • 
                            <span id="knowledgeCount">知识条目: 0</span> • 
                            <span id="lastUpdate">最后更新: --</span>
                        </div>
                        <div class="quick-actions">
                            <button class="btn btn-success" onclick="KnowledgeManager.refreshData()" title="刷新数据">
                                🔄 刷新
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 智能分析 -->
            <div id="analysis-tab" class="tab-content">
                <div class="tab-header">
                    <h2>🧠 智能分析中心</h2>
                                    <div class="control-panel">
                    <div class="analyzer-selector">
                        <label class="radio-label">
                            <input type="radio" name="analyzer" value="local" checked>
                            <span>🧠 本地Claude分析器</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="analyzer" value="openai">
                            <span>🤖 Azure OpenAI</span>
                        </label>
                    </div>
                    
                    <div class="project-selector">
                        <label for="projectScope">📁 分析范围:</label>
                        <select id="projectScope" class="project-dropdown">
                            <option value="project">🎯 当前项目 (cursor-chat-memory)</option>
                            <option value="all">🌐 所有会话</option>
                            <option value="category">📂 按分类过滤</option>
                        </select>
                        
                        <select id="categoryFilter" class="category-dropdown" style="display: none;">
                            <option value="">选择分类...</option>
                            <option value="性能优化">性能优化</option>
                            <option value="代码实现">代码实现</option>
                            <option value="系统设计">系统设计</option>
                            <option value="问题解决">问题解决</option>
                            <option value="开发工具">开发工具</option>
                        </select>
                    </div>
                </div>
                </div>

                <!-- 流程指导 -->
                <div class="workflow-guide">
                    <h3>🎯 建议的分析流程</h3>
                    <div class="workflow-steps">
                        <div class="workflow-step" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>首次使用：智能整合</h4>
                                <p>整合现有提示词，优化知识结构</p>
                            </div>
                        </div>
                        <div class="workflow-step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>定期执行：批量提炼</h4>
                                <p>分析新增会话，提取关键信息</p>
                            </div>
                        </div>
                        <div class="workflow-step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>项目总结：知识图谱</h4>
                                <p>生成项目全貌，获得深度洞察</p>
                            </div>
                        </div>
                    </div>
                    <div class="project-info">
                        <span id="currentProject">🏗️ 当前项目: cursor-chat-memory</span>
                        <span id="projectSessionCount">📊 项目会话: 加载中...</span>
                    </div>
                </div>
                
                <div class="analysis-dashboard">
                    <div class="analysis-grid">
                        <!-- 智能提炼 -->
                        <div class="analysis-card">
                            <h3>📝 智能提炼</h3>
                            <p>从历史会话中提取关键技术信息和解决方案</p>
                            <div class="analysis-actions">
                                <button id="batchSummarizeBtn" class="btn btn-primary">📚 批量提炼会话</button>
                                <button id="singleSummarizeBtn" class="btn btn-secondary">📄 单会话提炼</button>
                            </div>
                            <div id="summarizeResults" class="analysis-results">
                                <!-- 提炼结果 -->
                            </div>
                        </div>

                        <!-- 智能整合 -->
                        <div class="analysis-card">
                            <h3>🔧 智能整合</h3>
                            <p>整合现有提示词模板，去除冗余，优化结构</p>
                            <div class="analysis-actions">
                                <button id="smartIntegrateBtn" class="btn btn-primary">🚀 开始整合</button>
                                <button id="viewKnowledgeBaseBtn" class="btn btn-secondary">📚 查看知识库</button>
                            </div>
                            <div id="integrateResults" class="analysis-results">
                                <!-- 整合结果 -->
                            </div>
                        </div>

                        <!-- 项目知识图谱 -->
                        <div class="analysis-card full-width">
                            <h3>📊 项目知识图谱</h3>
                            <p>分析项目整体架构、技术栈、挑战和解决方案模式</p>
                            <div class="analysis-actions">
                                <button id="generateKnowledgeBtn" class="btn btn-primary">🎯 生成知识图谱</button>
                                <button id="viewProjectKnowledgeBtn" class="btn btn-secondary">📖 查看现有图谱</button>
                            </div>
                            <div id="knowledgeResults" class="analysis-results">
                                <!-- 知识图谱结果 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 统计分析 -->
            <div id="analytics-tab" class="tab-content">
                <div class="tab-header">
                    <h2>📊 统计分析</h2>
                </div>
                
                <div class="analytics-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>会话统计</h3>
                            <div id="sessionStats" class="stat-content">
                                <!-- 会话统计信息 -->
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>提示词统计</h3>
                            <div id="promptStats" class="stat-content">
                                <!-- 提示词统计信息 -->
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>分类分布</h3>
                            <div id="categoryStats" class="stat-content">
                                <!-- 分类统计信息 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>



    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">标题</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 模态框内容 -->
            </div>
            <div class="modal-footer">
                <button id="modalCancel" class="btn btn-secondary">取消</button>
                <button id="modalConfirm" class="btn btn-primary">确认</button>
            </div>
        </div>
    </div>

    <!-- 加载指示器 -->
    <div id="loading" class="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>加载中...</p>
        </div>
    </div>

    <!-- 通知容器 -->
    <div id="notifications" class="notifications">
        <!-- 通知消息将在这里显示 -->
    </div>



    <!-- 异步加载非关键JS -->
    <script defer src="script.js"></script>
    
    <!-- 初始化脚本 -->
    <script>
        // 性能监控
        window.addEventListener('load', () => {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('页面加载时间：', perfData.loadEventEnd - perfData.fetchStart, 'ms');
            }
        });

        // 启用懒加载
        document.addEventListener('DOMContentLoaded', () => {
            if ('IntersectionObserver' in window) {
                PerformanceUtils?.lazyLoadImages();
            }
        });

        // 离线检测
        window.addEventListener('online', () => {
            console.log('网络连接已恢复');
        });
        
        window.addEventListener('offline', () => {
            console.log('网络连接已断开');
        });
    </script>
</body>
</html> 